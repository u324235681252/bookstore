{% extends 'base.html' %}

{% block title %}Мои аренды{% endblock %}

{% block content %}
<div class="mb-4">
    <h1 class="display-5 fw-bold">
        <i class="fas fa-book-reader"></i> Мои аренды
    </h1>
    <p class="lead text-muted">История аренды книг</p>
</div>

{% if rentals %}
    <div class="row g-4">
        {% for rental in rentals %}
        <div class="col-md-6">
            <div class="card">
                <div class="row g-0">
                    <div class="col-md-4">
                        <img src="{{ rental.book.get_image }}" class="img-fluid rounded-start h-100" alt="{{ rental.book.title }}" style="object-fit: cover;">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title mb-0">{{ rental.book.title }}</h5>
                                {% if rental.returned %}
                                    <span class="badge bg-secondary">Возвращена</span>
                                {% elif rental.is_expired %}
                                    <span class="badge bg-danger">Просрочена</span>
                                {% elif rental.days_until_expiry <= 3 %}
                                    <span class="badge bg-warning">Скоро истекает</span>
                                {% else %}
                                    <span class="badge bg-success">Активна</span>
                                {% endif %}
                            </div>

                            <p class="card-text">
                                <strong>Автор:</strong> {{ rental.book.author.name }}<br>
                                <strong>Период:</strong> {{ rental.get_rental_period_display }}<br>
                                <strong>Цена:</strong> {{ rental.price }} ₽
                            </p>

                            <p class="card-text">
                                <small class="text-muted">
                                    <i class="far fa-calendar-check"></i> Арендовано {{ rental.rented_at|date:"d.m.Y" }}<br>
                                    <i class="far fa-calendar-times"></i> Истекает {{ rental.expires_at|date:"d.m.Y" }}
                                </small>
                            </p>

                            {% if not rental.returned %}
                                <div class="alert alert-info py-2 mb-2">
                                    {% if rental.is_expired %}
                                        <i class="fas fa-exclamation-triangle"></i> Срок аренды истёк!
                                    {% else %}
                                        <i class="fas fa-clock"></i> Осталось дней: <strong>{{ rental.days_until_expiry }}</strong>
                                    {% endif %}
                                </div>
                            {% endif %}

                            <a href="{% url 'book_detail' rental.book.id %}" class="btn btn-primary btn-sm">
                                <i class="fas fa-eye"></i> Подробнее
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="card mt-4 p-4 bg-light">
        <h5>Статистика аренды</h5>
        <div class="row">
            <div class="col-md-4">
                <p class="mb-0"><strong>Всего аренд:</strong> {{ rentals.count }}</p>
            </div>
            <div class="col-md-4">
                <p class="mb-0"><strong>Активных:</strong>
                    {{ rentals|length }}
                    {% comment %}Здесь должен быть подсчет активных{% endcomment %}
                </p>
            </div>
            <div class="col-md-4">
                <p class="mb-0"><strong>Возвращено:</strong>
                    {% comment %}Здесь должен быть подсчет возвращенных{% endcomment %}
                </p>
            </div>
        </div>
    </div>
{% else %}
    <div class="card p-5 text-center">
        <i class="fas fa-book-reader fa-4x text-muted mb-3"></i>
        <h4>У вас пока нет арендованных книг</h4>
        <p class="text-muted">Арендуйте книгу и начните читать уже сегодня!</p>
        <a href="{% url 'book_list' %}" class="btn btn-primary mt-3">
            <i class="fas fa-books"></i> Перейти в каталог
        </a>
    </div>
{% endif %}
{% endblock %}